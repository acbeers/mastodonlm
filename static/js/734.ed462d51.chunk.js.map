{"version":3,"file":"static/js/734.ed462d51.chunk.js","mappings":"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","sources":["types.ts","workerbase.ts","clientworker.ts","../webpack/bootstrap","../webpack/runtime/chunk loaded","../webpack/runtime/define property getters","../webpack/runtime/ensure chunk","../webpack/runtime/get javascript chunk filename","../webpack/runtime/get mini-css chunk filename","../webpack/runtime/global","../webpack/runtime/hasOwnProperty shorthand","../webpack/runtime/publicPath","../webpack/runtime/importScripts chunk loading","../webpack/runtime/startup chunk dependencies","../webpack/startup"],"sourcesContent":["// Types use in the Mastodon List Manager\n\n// A list returned by a Mastodon API\nexport type List = {\n  id: string;\n  title: string;\n};\n\n// A user returned by the Mastodon API\nexport type User = {\n  id: string;\n  display_name: string;\n  username: string;\n  avatar: string;\n  acct: string;\n  note: string;\n  lists: string[];\n  following_count: number;\n};\n\n// A group of users as shown in the interface\nexport type Group = {\n  key: string;\n  followers: User[];\n};\n\n// The data returned by our backend API\nexport type APIData = {\n  followers: User[];\n  lists: List[];\n  me: User;\n};\n\n// A data structure representing an in progress list operation\nexport type InProgress = {\n  list: string;\n  follower: string;\n};\n\nexport class TimeoutError extends Error {\n  constructor(msg: string) {\n    super();\n    this.name = \"TimeoutError\";\n    this.message = msg;\n  }\n}\n\nexport class AuthError extends Error {\n  constructor() {\n    super();\n    this.name = \"AuthError\";\n    this.message = \"Not authenticated\";\n  }\n}\n","// Baseclass for client and server workers\n\nimport { User } from \"./types\";\n\n// Endpoints\nconst urlTelemetry = process.env.REACT_APP_BACKEND_URL + \"/telemetry\";\nconst urlError = process.env.REACT_APP_BACKEND_URL + \"/error\";\n\nexport class WorkerBase {\n  protected me: User | null = null;\n\n  // Logs a telemetry event\n  async telemetry(info: Record<string, any>): Promise<void> {\n    const data = { ...info };\n    if (this.me) data.acct = this.me.acct;\n\n    return fetch(urlTelemetry, {\n      credentials: \"include\",\n      method: \"POST\",\n      body: JSON.stringify(data),\n    }).then(() => {\n      return;\n    });\n  }\n\n  // Logs an error event\n  async error(info: Record<string, any>): Promise<void> {\n    const data = { ...info };\n    if (this.me) data.acct = this.me.acct;\n\n    return fetch(urlError, {\n      credentials: \"include\",\n      method: \"POST\",\n      body: JSON.stringify(data),\n    }).then(() => {\n      return;\n    });\n  }\n}\n","// Web Worker\n\nimport { User, List, APIData, TimeoutError, AuthError } from \"./types\";\nimport * as Comlink from \"comlink\";\nimport { login } from \"masto\";\nimport { WorkerBase } from \"./workerbase\";\n\n// Endpoints\nconst urlAuth = process.env.REACT_APP_BACKEND_URL + \"/auth\";\nconst urlCallback = process.env.REACT_APP_BACKEND_URL + \"/clientcallback\";\nconst urlLogout = process.env.REACT_APP_BACKEND_URL + \"/clientlogout\";\n\nasync function asyncForEach(\n  array: any[],\n  callback: (a: any, n: number, x: any[]) => void\n) {\n  for (let index = 0; index < array.length; index++) {\n    await callback(array[index], index, array);\n  }\n}\n\n// Given a fetch response, check it for errors and throw\n// reasonable exceptions if so.  Otherwise, return the response\n// converted to JSON.\nconst checkJSON = (resp: Response) => {\n  if (resp.status === 401 || resp.status === 403) throw new AuthError();\n  if (!resp.ok) throw Error(\"An error occurred\");\n\n  return resp\n    .json()\n    .then((data) => {\n      if (data.errorType === \"LambdaTimeoutError\")\n        throw new TimeoutError(\"Backend timeout\");\n      if (data.message === \"Service Unavailable\")\n        throw new TimeoutError(\"Backend timeout (likely)\");\n      return data;\n    })\n    .catch((err) => {\n      throw new Error(`An error occurred: ${err}`);\n    });\n};\n\nexport default class APIWorker extends WorkerBase {\n  private token: string | null = null;\n  private domain: string | null = null;\n  private debug: number = 0;\n\n  constructor() {\n    super();\n    this.debug = Date.now();\n  }\n\n  private instance() {\n    if (!this.token) throw Error(\"API not ready\");\n\n    return login({\n      url: `https://${this.domain}`,\n      accessToken: this.token,\n    });\n  }\n\n  async ready(): Promise<boolean> {\n    return this.token !== null;\n  }\n\n  async logout(): Promise<void> {\n    const params = {\n      token: this.token,\n      domain: this.domain,\n    };\n    return fetch(urlLogout, {\n      credentials: \"include\",\n      method: \"POST\",\n      body: JSON.stringify(params),\n    }).then(() => {\n      return;\n    });\n  }\n\n  // Returns a string with the authorize redirect\n  async auth(domain: string): Promise<string> {\n    const res: string = await fetch(`${urlAuth}?domain=${domain}`)\n      .then((resp) => checkJSON(resp))\n      .then((data) => data.url);\n    return res;\n  }\n\n  // Given a code, completes the OAuth dance, storing a token for this\n  // worker to use to access APIs.\n  async callback(code: string, domain: string): Promise<void> {\n    // If we already have a token, don't run the below.\n    if (this.token) return;\n\n    const self = this;\n    await fetch(`${urlCallback}?code=${code}&domain=${domain}`, {\n      credentials: \"include\",\n      method: \"POST\",\n    })\n      .then((resp) => checkJSON(resp))\n      .then((data) => {\n        self.token = data.token;\n        self.domain = domain;\n      });\n  }\n\n  // Returns information about follows and lists\n  // Returns an object of type APIData\n  async info(callback: (value: number) => void): Promise<APIData> {\n    if (!this.ready()) throw Error(\"API not ready\");\n    if (!this.token) throw Error(\"API not ready\");\n\n    const self = this;\n    return login({\n      url: `https://${this.domain}`,\n      accessToken: this.token,\n    }).then((masto) => {\n      return masto.v1.accounts\n        .verifyCredentials()\n        .then((me) => {\n          const meuser = {\n            id: me.id,\n            display_name: me.displayName,\n            username: me.username,\n            avatar: me.avatar,\n            acct: me.acct + \"@\" + self.domain,\n            note: me.note,\n            lists: [],\n            following_count: me.followingCount,\n          };\n          self.me = meuser;\n          return {\n            followers: [],\n            lists: [],\n            me: meuser,\n          };\n        })\n        .then(async (data: APIData) => {\n          let res: List[] = [];\n          for await (const lists of masto.v1.lists.list()) {\n            const batch: List[] = lists.map((list) => ({\n              id: list.id,\n              title: list.title,\n            }));\n            res = res.concat(batch);\n          }\n          return { followers: data.followers, lists: res, me: data.me };\n        })\n        .then(async (data: APIData) => {\n          let res: User[] = [];\n          for await (const users of masto.v1.accounts.listFollowing(\n            data.me.id\n          )) {\n            const batch: User[] = users.map((user) => ({\n              id: user.id,\n              display_name: user.displayName,\n              username: user.username,\n              avatar: user.avatar,\n              acct: user.acct,\n              note: user.note,\n              following_count: 0,\n              lists: [],\n            }));\n            res = res.concat(batch);\n            callback(\n              (100 * res.length) / (data.me.following_count + data.lists.length)\n            );\n          }\n          // Build a map\n          const followerMap: Record<string, User> = {};\n          res.forEach((u) => {\n            followerMap[u.id] = u;\n          });\n          // Now pull list memberships\n          await asyncForEach(data.lists, async (list, idx) => {\n            for await (const users of masto.v1.lists.listAccounts(list.id)) {\n              users.forEach((user) => {\n                const fol = followerMap[user.id];\n                if (fol) {\n                  fol.lists.push(list.id);\n                }\n              });\n              callback(\n                (100 * (data.me.following_count + idx)) /\n                  (data.me.following_count + data.lists.length)\n              );\n            }\n          });\n          return { followers: res, lists: data.lists, me: data.me };\n        })\n        .then((data) => data);\n    });\n  }\n\n  // Creates a new list\n  async createList(list_name: string): Promise<List> {\n    return this.instance().then((masto) => {\n      return masto.v1.lists.create({ title: list_name });\n    });\n  }\n\n  // Deletes a list\n  async deleteList(list_id: string): Promise<void> {\n    return this.instance().then((masto) => {\n      masto.v1.lists.remove(list_id);\n    });\n  }\n\n  // Adds a user to a list\n  async addToList(list_id: string, follower_id: string): Promise<void> {\n    if (!this.ready()) throw Error(\"API not ready\");\n    if (!this.token) throw Error(\"API not ready\");\n\n    return login({\n      url: `https://${this.domain}`,\n      accessToken: this.token,\n    }).then((masto) => {\n      return masto.v1.lists.addAccount(list_id, { accountIds: [follower_id] });\n    });\n  }\n\n  // Removes a user from a list\n  async removeFromList(list_id: string, follower_id: string): Promise<void> {\n    if (!this.ready()) throw Error(\"API not ready\");\n    if (!this.token) throw Error(\"API not ready\");\n\n    return login({\n      url: `https://${this.domain}`,\n      accessToken: this.token,\n    }).then((masto) => {\n      return masto.v1.lists.removeAccount(list_id, {\n        accountIds: [follower_id],\n      });\n    });\n  }\n\n  // Creates a new list and imports data into it\n  async importList(list_name: string, data: string[]): Promise<void> {\n    // FIXME: We should allow importing into an existing list.\n    return this.instance().then((masto) => {\n      return masto.v1.lists.create({ title: list_name }).then((newlist) => {\n        const list_id = newlist.id;\n        // FIXME: data needs to be translated into account IDs, not acct strings.\n        const proms = data.map((acct) => masto.v1.accounts.lookup({ acct }));\n        return Promise.all(proms).then((accts) => {\n          const ids = accts.map((x) => x.id);\n          return masto.v1.lists.addAccount(list_id, { accountIds: ids });\n        });\n\n        // FIXME: If data is too long, we might get into problems.\n        // FIXME: We should offer to follow accounts that we aren't following already.\n        // But, that API is one account at a time, so could run afoul of API limits.\n        // FIXME: Perhaps I just need to have a limit of e.g. 50 accounts, plus go to\n        // some efforts to not do any work for accounts that I already know about.\n      });\n    });\n  }\n}\nComlink.expose(APIWorker);\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n// the startup function\n__webpack_require__.x = function() {\n\t// Load entry module and return exports\n\t// This entry module depends on other loaded chunks and execution need to be delayed\n\tvar __webpack_exports__ = __webpack_require__.O(undefined, [144,916], function() { return __webpack_require__(7775); })\n\t__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n\treturn __webpack_exports__;\n};\n\n","var deferred = [];\n__webpack_require__.O = function(result, chunkIds, fn, priority) {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar chunkIds = deferred[i][0];\n\t\tvar fn = deferred[i][1];\n\t\tvar priority = deferred[i][2];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every(function(key) { return __webpack_require__.O[key](chunkIds[j]); })) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// define getter functions for harmony exports\n__webpack_require__.d = function(exports, definition) {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.f = {};\n// This file contains only the entry chunk.\n// The chunk loading function for additional chunks\n__webpack_require__.e = function(chunkId) {\n\treturn Promise.all(Object.keys(__webpack_require__.f).reduce(function(promises, key) {\n\t\t__webpack_require__.f[key](chunkId, promises);\n\t\treturn promises;\n\t}, []));\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.u = function(chunkId) {\n\t// return url for filenames based on template\n\treturn \"static/js/\" + chunkId + \".\" + {\"144\":\"d2d8652c\",\"916\":\"8e9dbd35\"}[chunkId] + \".chunk.js\";\n};","// This function allow to reference async chunks and sibling chunks for the entrypoint\n__webpack_require__.miniCssF = function(chunkId) {\n\t// return url for filenames based on template\n\treturn undefined;\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = function(obj, prop) { return Object.prototype.hasOwnProperty.call(obj, prop); }","__webpack_require__.p = \"/mastodonlm/\";","// no baseURI\n\n// object to store loaded chunks\n// \"1\" means \"already loaded\"\nvar installedChunks = {\n\t734: 1\n};\n\n// importScripts chunk loading\nvar installChunk = function(data) {\n\tvar chunkIds = data[0];\n\tvar moreModules = data[1];\n\tvar runtime = data[2];\n\tfor(var moduleId in moreModules) {\n\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t}\n\t}\n\tif(runtime) runtime(__webpack_require__);\n\twhile(chunkIds.length)\n\t\tinstalledChunks[chunkIds.pop()] = 1;\n\tparentChunkLoadingFunction(data);\n};\n__webpack_require__.f.i = function(chunkId, promises) {\n\t// \"1\" is the signal for \"already loaded\"\n\tif(!installedChunks[chunkId]) {\n\t\tif(true) { // all chunks have JS\n\t\t\timportScripts(__webpack_require__.p + __webpack_require__.u(chunkId));\n\t\t}\n\t}\n};\n\nvar chunkLoadingGlobal = self[\"webpackChunklist_manager\"] = self[\"webpackChunklist_manager\"] || [];\nvar parentChunkLoadingFunction = chunkLoadingGlobal.push.bind(chunkLoadingGlobal);\nchunkLoadingGlobal.push = installChunk;\n\n// no HMR\n\n// no HMR manifest","var next = __webpack_require__.x;\n__webpack_require__.x = function() {\n\treturn Promise.all([\n\t\t__webpack_require__.e(144),\n\t\t__webpack_require__.e(916)\n\t]).then(next);\n};","// run startup\nvar __webpack_exports__ = __webpack_require__.x();\n"],"names":["TimeoutError","msg","name","message","Error","AuthError","WorkerBase","me","info","data","this","acct","fetch","process","credentials","method","body","JSON","stringify","then","asyncForEach","array","callback","index","length","checkJSON","resp","status","ok","json","errorType","catch","err","APIWorker","token","domain","debug","Date","now","login","url","accessToken","params","res","code","self","ready","masto","v1","accounts","verifyCredentials","meuser","id","display_name","displayName","username","avatar","note","lists","following_count","followingCount","followers","list","batch","map","title","concat","listFollowing","users","user","followerMap","forEach","u","idx","listAccounts","fol","push","list_name","instance","create","list_id","remove","follower_id","addAccount","accountIds","removeAccount","newlist","proms","lookup","Promise","all","accts","ids","x","Comlink","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","undefined","exports","module","__webpack_modules__","m","__webpack_exports__","O","deferred","result","chunkIds","fn","priority","notFulfilled","Infinity","i","fulfilled","j","Object","keys","every","key","splice","r","d","definition","o","defineProperty","enumerable","get","f","e","chunkId","reduce","promises","miniCssF","g","globalThis","Function","window","obj","prop","prototype","hasOwnProperty","call","p","installedChunks","importScripts","chunkLoadingGlobal","parentChunkLoadingFunction","bind","moreModules","runtime","pop","next"],"sourceRoot":""}